---
title: NGINX One Console Lab
description: An interactive lab highlighting the NGINX One Console
order: 3
---

## Console Overview

Now that we have set up our data plane key and deployed our NGINX instances we can take a look around the NGINX One Console:

1. Return to the NGINX One Console. From the left menu in the *Manage* section, click *Instances*.

1. You should see your **<GetVariable name="nginx-plus-1" />** instance in the list, click on it to view the instance details.

    ![NGINX One Instance List](media/lab2-7.png)

### Explore the instance details

The NGINX One Console provides several key metrics for us to evaluate:

    - Instance Certificates
    - Instance CVEs
    - Configuration Recommendations
    - Instance Details

    ![NGINX Plus instance details](media/lab2-8.png)

#### Instance Certificates

The NGINX One Console displays the number of certificates currently installed on the NGINX instance as well as the current status of the certificates, expiration date, 
and the certificate's *Subject Name*.

We'll get to explore this in greater detail later in the lab when we install a SSL/TLS certificate.

#### Instance CVEs

The NGINX One Console displays the number of CVEs associated with the NGINX instance as well as their severity.  You can also find out more information about each CVE
with a link to the CVE Program website with extensive details about the CVE in question.

#### Configuration Recommendations

The NGINX One Console will evaluate the NGINX instance configuration and provide recommendations based on best practices and security concerns.
We'll get to explore this in greater detail later in the lab when we configure the stub_status location.

#### Instance Details

The NGINX One Console also provides various details about the NGINX instance such as:

    | Instance Type | Description |
    | --- | --- |
    | Availability | The availability status of the NGINX instance |
    | Data Plane Key | The data plane key associated with the NGINX instance |
    | Hostname | The hostname of the NGINX instance |
    | Last Seen | The last time the NGINX instance was seen |
    | NGINX Agent Version | The version of the NGINX Agent running on the instance |
    | NGINX Config Path | The path to the NGINX configuration file |
    | Operating System | The operating system running on the instance |
    | Registration Time | The time when the NGINX instance was registered |
    | Instance Type | The type of the NGINX instance |

---

## Configuration via the Console

In this section, we will leverage NGINX One Console to enable the [stub_status](https://nginx.org/en/docs/http/ngx_http_stub_status_module.html?_ga=2.62776364.1844058681.1724599557-1323320886.1720986347) 
location in our **<GetVariable name="nginx-plus-1" />** NGINX instance's configuration.

The stub_status allows users to collect basic metrics about the NGINX instance such as:

- Active connections
- Total number of accepted client connections
- Total number of client requests
- and many more

### Adding a stub_status directive

1. In the NGINX One console, select *Manage* and then *Instances* from the left menu.

1. You should see your *<GetVariable name="nginx-plus-1" />* instance in the list. Click it to view the instance details.

1. Click the *Configuration* link near the top of the instance screen. You will be presented with the configuration editor.

    ![Configuration link](media/lab3-1.png)


#### NGINX Configuration

Now let's take a look at what the **/etc/nginx/nginx.conf** configuration is doing:

```nginx
user  nginx;
worker_processes  auto;

error_log  /var/log/nginx/error.log notice;
pid        /var/run/nginx.pid;

events {
    worker_connections  1024;
}
```

Let's break down this portion of the NGINX configuration:

**1. *user  nginx;***

This line specifies the user under which NGINX will run as a process. In this case, it's running as the *nginx* user. This is important for security and permission reasons.

When NGINX starts, it needs to bind to certain system resources (e.g., network sockets). By specifying a specific user, we ensure that any processes started by NGINX will run with minimal privileges, reducing the risk of unauthorized access or resource consumption.

**2. worker_processes  auto;**

This line configures how many worker processes NGINX will create to handle incoming requests. The value is set to *auto*, which means that NGINX will automatically determine the optimal number of workers based on the system's capabilities and load.

The *auto* value tells NGINX to:

    * On systems with multiple CPU cores, create a worker process for each core.
    * On systems with a single CPU core, use the system's default maximum process limit (usually 1024).
    * Consider other factors like memory availability and load when deciding on the optimal number of workers.

**3. error_log  /var/log/nginx/error.log notice;**

This line configures how NGINX logs errors that occur during execution. The *notice* level is set, which means that:

    * Errors with a severity level greater than or equal to NOTICE will be logged.
    * Other error levels (e.g., ERROR, WARNING) won't be logged.

The log file location */var/log/nginx/error.log* indicates where NGINX will write its error messages. This is the standard log location for most Linux distributions.

**4. pid /var/run/nginx.pid;**

This line specifies the file path where NGINX will store its process ID (PID). The PID is a unique identifier that allows you to manage and monitor running processes on your system.

In this case, the PID is written to */var/run/nginx.pid*, which is a common location for Linux services like NGINX.

**5. worker_connections 1024;**

This line specifies the maximum number of simultaneous connections a worker process can handle. In this case, it's set to 1024, which means each worker process will be able to accept up to 1024 simultaneous client connections.

```nginx
http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    access_log  /var/log/nginx/access.log  main;

    sendfile        on;
    #tcp_nopush     on;

    keepalive_timeout  65;

    #gzip  on;

    include /etc/nginx/conf.d/*.conf;
}
```

Here's a brief explanation of this portion of the NGINX configuration:

**HTTP Block**

This block configures how NGINX handles HTTP requests.

**1. include /etc/nginx/mime.types;** 

Includes the MIME types file, which maps file extensions to their corresponding content types.

**2. default_type application/octet-stream;** 

Specifies the default response type for unknown content types.

**3. log_format main ...** 

Defines a custom log format called "main", which logs various request details (e.g., client IP, user agent).

**4. access_log /var/log/nginx/access.log main;** 

Enables access logging to the specified file using the defined log format.

**5. sendfile on;** 

Enables the sendfile() method for sending files directly from disk to clients, improving performance.

**6. keepalive_timeout 65;** 

Sets the keep-alive timeout to 65 seconds, allowing NGINX to maintain connections with clients for a longer period.

**7. include /etc/nginx/conf.d/*.conf;**

Includes all configuration files in the specified directory (e.g., virtual hosts).

Now lets take a look at what the **/etc/nginx/conf.d/default.conf** configuration is doing:

```nginx
server {
    listen       80 default_server;
    server_name  localhost;

    #access_log  /var/log/nginx/host.access.log  main;

    location / {
        root   /usr/share/nginx/html;
        index  index.html index.htm;
    }

    #error_page  404              /404.html;

    # redirect server error pages to the static page /50x.html
    #
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }
}
```

Here's a brief overview of this NGINX configuration:

**Server Block**

This block configures a single server that listens on port 80 and responds to requests for the domain *localhost*.

- *listen 80 default_server;* specifies that this server should listen on port 80 by default.
- *server_name localhost;* indicates that this server will respond to requests from the domain *localhost*.

**Root Directory and Indexing**

The configuration sets up a single location block that serves files from the */usr/share/nginx/html* directory:

- *root /usr/share/nginx/html;* specifies the root directory for this location.
- *index index.html index.htm;* specifies the default index file to serve when no specific file is requested (in this case, either *index.html* or *index.htm*).

**Error Handling**

The configuration also sets up error handling:

- *error_page 500 502 503 504 /50x.html;* specifies that if any of these specific HTTP errors occur, the client should be redirected to the static page */50x.html*.
- *location = /50x.html* specifies where NGINX can find the error page file.

#### Edit the NGINX Configuration

1. Click the *Edit Configuration* button above the editor.

    ![Edit Configuration link](media/lab3-2.png)

1. Select the **/etc/nginx/conf.d/default.conf** file from the tree view on the left side of the configuration editor.

    ![Select demo.conf file](media/lab3-3.png)

1. Edit the selected file to include a location block at the end of the server block with
    the "stub_status" directive. Add the following location block to the server block:

    ```nginx
    location = /nginx_status {
        stub_status;
    }
    ```

    The file should like this, commented out configurations have been removed:

    ```nginx
    server {
        listen       80 default_server;
        server_name  localhost;

        #access_log  /var/log/nginx/host.access.log  main;

        location / {
            root   /usr/share/nginx/html;
            index  index.html index.htm;
        }

        #error_page  404              /404.html;

        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   /usr/share/nginx/html;
        }
    
        location = /nginx_status {
            stub_status;
            access_log off;
        }    
    }

    ```

1. You will see that there is a message below the editor: 

    > *1 recommendation found for /etc/nginx/conf.d/demo.conf <br />
        Security - Error: stub_status should have access control list defined*. 

    - **Why?** NGINX One includes a configuration advisor and it identified that exposing the **stub_status** endpoint open to the world is considered a security risk. 
    - We can remediate this by adding an ACL to the **/nginx_status** location block to only allow our lab environments's local networks and NGINX Agent (running locally on the instance) to access the stub status endpoint.

    ![config warning](media/lab3-4.png)

1. Update the configuration to the following:

    ```nginx
    location /nginx_status {
        stub_status;
        allow 10.0.0.0/8;
        allow 172.18.0.0/16;
        allow 127.0.0.1;
        deny all;
    }
    ```

    Note that the warning should disappear.

1. Click *Next* to display the diff viewer. This view will show you the changes made to the configuration.

    ![Diff viewer](media/lab3-5.png)

1. Click *Save and Publish*. You will see a status message indicating changes are being published, followed by a success message after several seconds.

    ![Publish config pending](media/lab3-6.png)

    ![Publish config success](media/lab3-7.png)

1. Check that the *stub_status* module is working by clicking the *Check* button below.

    <APICheck 
        componentName="nginx-plus-1" 
        path="/nginx_status" 
        targetStatusCode={200}  
    />

### Using a TLS certificate

In this section, we will configure our **<GetVariable name="nginx-plus-1" />** NGINX instance to leverage an SSL/TLS certificate. 

1. In the NGINX One Console, edit the **/etc/nginx/conf.d/demo.conf** file again for the *<GetVariable name="nginx-plus-1" />* instance to add the following to the server block:

    ```nginx
    listen 443 ssl;
    ssl_certificate /etc/nginx/ssl/wildcard.f5demos.com.crt.pem;
    ssl_certificate_key /etc/nginx/ssl/wildcard.f5demos.com.key.pem;
    ```

1. Click *Next* to display the diff viewer. This view will show you the changes made to the configuration.

    ![Diff viewer](media/lab3-9.png)

1. Click *Save and Publish*. You will see a status message indicating changes are being published, followed by a success message after several seconds.

1. Click the *Details* link on the page. You should now see the certificate, its validity status, expiration date, and subject name. 

    ![Details link](media/lab3-10.png)

1. The *details* page will also show a new recommendation. You can view the configuration, and recommendations by clicking the *View Configuration* link in the *Configuration Recommendations* section.

    ![Certificate status](media/lab3-11.png)

1. Select the *default.conf* file from the file picker. Note the blue dots and the number "1" next to default.conf; the configuration viewer highlights the location(s) of any recommendations it has for the NGINX configuration.

    ![Configuration Viewer](media/lab3-12.png)

1. Notice the editor has a "Best Practice" notice indicating that *default_server* should set. Update the configuration to acknowledge this recommendation. <br />&nbsp;<br />The entire **/etc/nginx/conf.d/default.conf** file should now look as follows, commented out configurations have been removed:

    ```nginx
    server {
        listen       80 default_server;
        server_name  localhost;

        listen 443 ssl default_server;
        ssl_certificate /etc/nginx/ssl/wildcard.f5demos.com.crt.pem;
        ssl_certificate_key /etc/nginx/ssl/wildcard.f5demos.com.key.pem;

        #access_log  /var/log/nginx/host.access.log  main;

        location / {
            root   /usr/share/nginx/html;
            index  index.html index.htm;
        }

        #error_page  404              /404.html;

        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   /usr/share/nginx/html;
        }
    
        location = /nginx_status {
            stub_status;
            access_log off;
        }    
    }
    ```

1. Check your work:<br />&nbsp;<br />To check that the <GetVariable name="nginx-plus-1" /> instance is now listening on 443 click the *Check* button below.

    <APICheck 
        componentName="nginx-plus-1" 
        targetStatusCode={200}
        tlsComponent={true} 
    />

## Config Sync Group

Config Sync Groups allow us to group multiple NGINX instances and leverage an identical configuration across all instances. This feature is extremely helpful in ephemeral environments, such as Docker and Kubernetes, as the NGINX instance can pull its configuration versus needing to rebuild the NGINX container every time the configuration changes. This section will go through using this feature.

### Creating Config Sync Group

1. Go to the NGINX One Console.

1. From the left menu in the *Manage* section, click on *Config Sync Groups*.

1. Click on *Add Config Sync Group*.

    ![Add Config Sync Group](media/lab5-1.png)

1. On the right, enter your unique lab deployment name, **<GetVariable name="petname" />**, then select *Create* on the bottom. Your new Config Sync Group is now created.

    ![New Config Sync Group](media/lab5-2.png)

You can now explore your Config Sync Group by selecting **<GetVariable name="petname" />** from the list. 
After you select it, there are two tabs named *Details* and *Configuration*. 
The configuration defined in this group will be used as the single NGINX config to use for all NGINX instances in this group. 

Notice the configuration is empty when you first create a Config Sync Group. There are two ways to handle the initial configuration.

**Option 1:** When you add the first NGINX instance, the config from the NGINX instance will be used as the config for your Config Sync Group. We will be using this option for this lab.

**Option 2:** You can manually define it before you add any NGINX instances.  We will examine this option later in the lab.

### Adding NGINX to config sync group

We will now proceed with adding an NGINX instance to the Config Sync Group.

#### Adding a New Instance

Lets start by adding an new NGINX Plus instance.

1. Click on *Add Instance to Config Sync Group*.

    ![Add Existing Instance](media/lab5-5.png)

1. We will be creating a new NGINX instance so make sure *Register a new instance with NGINX One then add to config sync group* is selected then click *Next*.

    > TODO: insert image

1. Select *Use existing Key* then *Docker Container*.

    > TODO: insert image

1. The instruction on the screen tell you how to: 
    - Login to the NGINX private registry
    - Pull an NGINX Plus instance from the NGINX private registry
    - Run the container with the required NGINX One Console connection details

```shell
# Login to Private Registry
sudo docker login private-registry.nginx.com --username=YOUR_JWT_HERE --password=none

# Pull the NGINX Plus container
sudo docker pull private-registry.nginx.com/nginx-plus/agent:debian

# Run the container and connect to NGINX One Console
sudo docker run \
--env=NMS_SERVER_GRPCPORT=443 \
--env=NMS_SERVER_HOST=agent.connect.nginx.com \
--env=NMS_SERVER_TOKEN="YOUR_DATA_PLANE_KEY" \
--env=NGINX_AGENT_INSTANCE_GROUP=drunk-sloth \
--env=NMS_TLS_ENABLE=true \
--restart=always \
--runtime=runc \
-d private-registry.nginx.com/nginx-plus/agent:debian

```

For the lab, we have simplified this process for you: 

1. Entering your *Config Sync Group* name below, which should be *<GetVariable name="petname" />* 

    <InputVariable 
        name="NGINX_AGENT_INSTANCE_GROUP"
    />

1. Click the *Run* button below to start a new NGINX Plus instance.

    <Docker  
        name="nginx-plus-2" 
        desc="NGINX Plus R32 with Agent." 
        image="private-registry.nginx.com/nginx-plus/agent:debian" 
        env={[
            {name: "NGINX_AGENT_SERVER_GRPCPORT", value: "443"},
            {name: "NGINX_AGENT_SERVER_HOST", value: "agent.connect.nginx.com"},
            {name: "NGINX_AGENT_TLS_ENABLE", value: "true"},
            {name: "NGINX_AGENT_TLS_SKIP_VERIFY", value: "false"},
            {name: "NGINX_AGENT_SERVER_TOKEN", isVariable: true, isSecret: true},
            {name: "NGINX_AGENT_INSTANCE_GROUP", isVariable: true}
        ]}
        attrs={[
            { name: "volume", value: "/tmp/ssl:/etc/nginx/ssl" }
        ]}
    />

1. Once the NGINX instance is up and running, press the *Test* button, to confirm the instance is online and responding to HTTP requests.

1. Now, in the NGINX One Console, look at your Config Sync Group and you should see a new instance registered.

    > TODO: update image

    ![First NGINX Instance](media/lab5-6.png)

1. When you select the *Configuration* tab, notice the config here is the same as the same initial config on your first NGINX instance.  

1. Based on what you have already learned, update the Config Sync Group configuration file **/etc/nginx/conf.d/default.conf** with the example below:

    ```nginx
    server {
        listen       80 default_server;
        server_name  localhost;

        #access_log  /var/log/nginx/host.access.log  main;

        location / {
            root   /usr/share/nginx/html;
            index  index.html index.htm;
        }

        #error_page  404              /404.html;

        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   /usr/share/nginx/html;
        }

        location /test_header {
            add_header X-Test-App true;
            return 200 'HTTP/1.1 200 OK\nContent-Type: text/html\n\n<html><body>Howdy!</body></html>';
        }
    }
    ```

1. Now we will test your configuration by clicking the *Check* button below:

    <APIHeaderCheck 
        componentName="nginx-plus-2" 
        headerName="X-Test-App"
        headerValue="true"
        path="/test_header" 
        targetStatusCode={200}  
    />

Great! You have successfully created a Config Sync Group and synchronized your first configuration.  Next, we will add a new instance to the Config Sync Group.

#### Adding a second NGINX Plus instance

Now that we added our first NGINX Plus instance to the Config Sync Group, let's add our second NGINX Plus instance, *<GetVariable name="nginx-plus-3" />*, to the Config Sync Group.

1. Click the *Run* button below to start a new NGINX Plus instance.

    <Docker
        name="nginx-plus-3" 
        desc="NGINX Plus R32 with Agent." 
        image="private-registry.nginx.com/nginx-plus/agent:debian" 
        env={[
            {name: "NGINX_AGENT_SERVER_GRPCPORT", value: "443"},
            {name: "NGINX_AGENT_SERVER_HOST", value: "agent.connect.nginx.com"},
            {name: "NGINX_AGENT_TLS_ENABLE", value: "true"},
            {name: "NGINX_AGENT_TLS_SKIP_VERIFY", value: "false"},
            {name: "NGINX_AGENT_SERVER_TOKEN", isVariable: true, isSecret: true},
            {name: "NGINX_AGENT_INSTANCE_GROUP", isVariable: true}
        ]}
        attrs={[
            { name: "volume", value: "/tmp/ssl:/etc/nginx/ssl" }
        ]}
    />

1. Verify the new NGINX instance is part of your *<GetVariable name="petname" />* Config Sync Group and wait for the Config Sync Status to transition from *Sync in Progress* to *In Sync*.

    >TODO: update picture

    ![Added Second NGINX Plus Instance](media/lab5-8.png)

1. Test that the configuration was synchronized to all instances:
    <APICheckContainer>
        <APIHeaderCheck 
            componentName="nginx-plus-2" 
            headerName="X-Test-App"
            headerValue="true"
            path="/test_header" 
            targetStatusCode={200}  
        />
        <APIHeaderCheck 
        componentName="nginx-plus-3" 
        headerName="X-Test-App"
        headerValue="true"
        path="/test_header" 
        targetStatusCode={200}  
        />
    </APICheckContainer>

### Updating and publishing configuration

Now that we have two instances in a Config Sync Group. Lets publish a new configuration to all instances that creates a new URL that returns an HTML response.

We will be making an update to the configuration defined in the config sync group then publish the change

1. Based on what you have already learned, add the following section to the **server** block:

    ```bash
    location /configsync {
        default_type text/html;
        return 200 '<html><body><h1>Published change made from NGINX One Config Sync Group</h1></body></html>';
    }
    ```

    The entire file should now look as follows:

    ```nginx
    server {
        listen       80 default_server;
        server_name  localhost;

        listen 443 ssl default_server;
        ssl_certificate /etc/nginx/ssl/wildcard.f5demos.com.crt.pem;
        ssl_certificate_key /etc/nginx/ssl/wildcard.f5demos.com.key.pem;

        #access_log  /var/log/nginx/host.access.log  main;

        location / {
            root   /usr/share/nginx/html;
            index  index.html index.htm;
        }

        #error_page  404              /404.html;

        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   /usr/share/nginx/html;
        }

        location /test_header {
            add_header X-Test-App true;
            return 200 'HTTP/1.1 200 OK\nContent-Type: text/html\n\n<html><body>Howdy!</body></html>';
        }

        location /configsync {
            default_type text/html;
            return 200 '<html><body><h1>Published change made from NGINX One Config Sync Group</h1></body></html>';
        } 
    }
    ```

We can now confirm the configuration changes on the NGINX instance by clicking the *Check* button for each NGINX instance below:

    <APICheckContainer>
        <APIResponseCheck 
            componentName="nginx-plus-2" 
            path="/configsync" 
            searchString="Config Sync Group"
            targetStatusCode={200}  
        />
        <APIResponseCheck 
            componentName="nginx-plus-3" 
            path="/configsync" 
            searchString="Config Sync Group"
            targetStatusCode={200}  
        />
    </APICheckContainer>

### Removing NGINX Instances from a Config Sync Group

As part of your day-to-day tasks, you may need to remove NGINX instances from a Config Sync Group.  This section will walk you through this process:

To remove NGINX Open Source from this instance group:

1. Navigate to your *<GetVariable name="petname" />* Config Sync Group 

1. Click the *Actions link for the *<GetVariable name="nginx-plus-3" />* instance and choose *delete*

    > TODO: update image

![Remove Instance](media/lab5-17.png)

> **Note:** Removing an NGINX instance from a Config Sync Group will also remove the instances from the NGINX One Console but will not remove the last active configuration.

#### Review

Great job! You have now simulated a common Day-2 operation of scaling or upgrading your NGINX instances and NGINX One Console made this process extremely easy and fast!  You can also do this via the [NGINX One Console API](https://docs.nginx.com/nginx-one/api/api-reference-guide/) if you prefer to handle these steps through a pipeline.


### Create a Config Sync Group for NGINX OSS

> TODO: create content around the story "a customer can create a config sync group with a custom configuration and any NGINX instance, NGINX OSS in this example, will automatically
pull it's configuration at start up."  Move the NGINX Docker OSS component here and update the component to pass the config sync group the user will create.

1. Click the *Configuration* tab then click on *Edit Configuration*

    ![Manually Create Initial Configuration](media/lab5-3.png)

1. An editor window appears that allows you to define the configuration to use for the NGINX instances.

    ![Manual Configuration](media/lab5-4.png)

1. You can also add files by clicking on *Add File* but this is limited to the **/etc/nginx/** path.

1. Select *Next* then *Save and Publish*

### Mixing NGINX Plus and NGINX Open Source Instances

> TODO: I am not a fan of negative examples, either remove this or find a better way to express what you are trying to explain - Cody

You will be able to mix NGINX Plus and NGINX Open Source instances with the exception that the configuration must be compatible across NGINX OSS and NGINX Plus. 
For example, you will not be able to publish NGINX Plus unique configurations like [JWT authenticate](https://docs.nginx.com/nginx/admin-guide/security-controls/configuring-jwt-authentication/) to NGINX Open Source.

We will now go through the steps of adding an NGINX OSS instance to your existing Config Sync Group:

1. Add your NGINX Open Source instance to your config sync group by repeating instructions from [Adding existing instance](#adding-existing-instance) that you did for NGINX Plus.

1. When you add the Open Source instance, the status shows "Out of Sync".

    ![Out of Sync Instance](media/lab5-15.png)

1. Click on your Open Source instance to view additional details about this. Notice the error message showing the reason why the configuration cannot be applied.

    ![Out of Sync Instance Details](media/lab5-16.png)

We will not go through the exercise of resolving the configuration such that it will be valid for both instance types. The point here is to show it is possible to mix instances and it is your responsibility to insure the configuration is valid for both NGINX Plus and NGINX Open Source.

## NGINX OSS (Optional)

The NGINX One Console supports both NGINX Plus and NGINX Open Source (NGINX OSS).  Both dataplanes leverage the NGINX Agent to communicate with the NGINX One Console API.  
The UDF blueprint contains a Ubuntu host with the package maintainer’s version of NGINX OSS installed.  In this section we will install NGINX Agent and connect this instance to the NGINX One Console. 

### Installing NGINX Agent on NGINX OSS

1. Connect to the "NGINX OSS" instance in UDF through the Web Shell access method by clicking the *Open Web Shell* button below:

    <UDFComponent
        name="NGINX OSS"
    />

1. Because the hostname is used as the name of the instance in NGINX One, you should change the hostname to something that identifies it as yours, such as **<GetVariable name="petname" />-ubuntu-oss**. 
Ensure that you are working on the NGINX OSS instance (default hostname ip-10.1.1.6), and run the following command below using only lowercase characters and hyphens. 

    > **Note:** The bash prompt will continue to show the previous hostname unless you log out and log back in. This does not affect the lab.

    ```bash
    sudo hostnamectl set-hostname unique-labname-ubuntu-oss
    ```

1. From the NGINX OSS instance, run the following command to install the NGINX Agent. Substitute data-plane-key with the key you saved in the first lab. Make sure you are working on the NGINX OSS instance; if you accidentally install on the jumphost, the installation will succeed, but there will be no NGINX instance for the agent to connect to and the instance will appear as "Offline". If this occurs, return to the directions in lab 1 to create a new Data Plane Key.

    ```bash
    curl https://agent.connect.nginx.com/nginx-agent/install | DATA_PLANE_KEY='data-plane-key' sh -s -- -y
    ```

    The install script will install any necessary dependencies, and install the NGINX Agent with the appropriate settings for your system. You will see a warning about "stub_status" not being configured. You can ignore that warning.

1. Return to the NGINX One console. From the left menu in the "Manage" section, click "Instances". You should see your new instance in the list.

1. Click its hostname to view the instance details.

    ![Instance list](media/lab4-2.png)

1. Explore the instance details.

    ![Instance Details](media/lab4-3.png)

    Note that this instance has a different set of configuration recommendations than the vanilla NGINX Plus instance did. Package maintainers may ship NGINX with their own sets of defaults, which may or may not align with best practices. NGINX One provides a centralized view of such recommendations across the organization.

<APICheck 
url="http://1.1.1.6" 
targetStatusCode={200} 
/>

## NGINX Docker (Optional)

The **Lab Framework** from the UDF environment has **docker** installed and is setup so it can run an NGINX Plus container image. The container image we will use here is **private-registry.nginx.com/nginx-plus/agent:debian** which has NGINX Plus with the Agent. If you want to see a list of all NGINX Plus with Agent tags, run the command below.

```bash
curl https://private-registry.nginx.com/v2/nginx-plus/agent/tags/list --key YOUR_NGINX_PLUS_KEY --cert YOUR_NGINX_PLUS_CERT
```

1. Go to the "Details" page of your Config Sync Group then click "Add Instance to Config Sync Group"

1. Select "Register a new instance with NGINX One then add to config sync group" then click "Next"

1. If you saved your "Data Plane Key" from a previous lab, select "Use existing Key". Otherwise select "Generate new key"

1. Provide your Data Plane Key if you selected "Use existing Key"

1. Select the "Docker Container" tab.

    ![Add New NGINX Plus Container](media/lab5-7.png)

1. Open a Web Shell to the **Lab Framework** UDF instance and start an NGINX Plus container with the commands to join it to your Config Sync Group. 

    > **Note:** This system already pulled the container image, so Steps 1 and 2 from above can be skipped.

    <UDFComponent
        name="Lab Framework"
    />

1. Run the *docker run* command outlined in Step 3 to start the NGINX Plus with Agent container. This command will also add this NGINX instance to your Config Sync Group.

1. Click "Done" to close out the window.

You will now see the second NGINX Plus instance added.

<APICheck 
url="http://1.1.1.7" 
targetStatusCode={200} 
/>

## Lab Cleanup

Time to clean up the resources you created in this lab. As a safety precaution, the NGINX One console will not allow you to delete an instance that is online. We will first have to shut down the instances before deleting them from the NGINX One console.

1. Delete your Config Sync Group Instances by going into your **<GetVariable name="petname" />** Config Sync Group Details and selecting the *Actions* link on the far right, then select *delete* for each instance.

    > TODO: add image

1. Delete your Config Sync Group by going to the *Config Sync Groups* list and selecting the *Actions* link on the far right.  Then select *delete*.

1. In the UDF deployment for this lab, click "Details" for the "NGINX OSS" component.

    ![Select the NGINX component details](media/cleanup-1.png)

1. Click the "Stop" button for this component.

    ![Select the NGINX component details](media/cleanup-2.png)

1. From the NGINX One console, in the left-hand menu in the "Manage" section, select "Instances".

1. Wait until the instance transitions to the "Unavailable" state before proceeding. You may need to click the "Refresh" button at the top right of the instance list.

    ![Instance Unavailable](media/cleanup-3.png)

1. Once Select the context menu for the NGINX OSS instance, and select
    "Delete".

    > :warning: **Warning:** Make sure you are deleting your own instance and not someone else’s.

    ![Deleting an instance](media/cleanup-4.png)

1. Confirm the deletion.

    ![Confirming the deletion](media/cleanup-5.png)

1. Repeat steps 1-6 for the NGINX Plus instance and the NGINX Plus container instance.

1. From the NGINX One console, in the left-hand menu in the "Manage" section, select "Data Plane Keys".

1. Select the context menu for the Data Plane Key you created in lab 1, and select "Revoke".

    > :warning: **Warning:** Make sure you are revoking your own key and not someone else’s.

    ![Revoking a Data Plane Key](media/cleanup-6.png)

1. Confirm the revocation.

    ![Confirming the revocation](media/cleanup-7.png)

1. From the NGINX One console, in the left-hand menu in the Manage section, select "Config Sync Groups".

1. Select the context menu for the Config Sync Group you created in lab 5, and select "Delete".

    ![Delete Config Sync Group](media/cleanup-8.png)

1. Click "Delete" to confirm.

END OF LAB